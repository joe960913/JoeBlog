<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><title>React.forwardRef &amp; React.lazy</title><link rel="shortcut icon" href="/images/ghost.jpg"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.2.0/styles/github.min.css"><script src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js"></script><meta name="generator" content="Hexo 4.0.0"></head><body><nav class="main-nav"><a href="/">Home</a><a href="/archives">Archives</a><a href="/about">About Me</a></nav><div class="profile"><section id="wrapper"><header id="header"><a href="/"><img class="2x" id="avatar" src="/images/ghost.jpg"></a><h1>Redamancy_13</h1><h2></h2></header></section></div><section class="post" id="wrapper"><article><header><h1>React.forwardRef & React.lazy</h1><h2 class="headline">Dec 12, 2019 4:51·
608 words
·
2 minutes read<span class="tags"></span></h2></header><section id="post-body"><h2 id="React-forwardRef-和-React-lazy"><a href="#React-forwardRef-和-React-lazy" class="headerlink" title="React.forwardRef 和 React.lazy"></a>React.forwardRef 和 React.lazy</h2><h3 id="1-React-forwardRef"><a href="#1-React-forwardRef" class="headerlink" title="1. React.forwardRef"></a>1. React.forwardRef</h3><p>React.forwardRef会创建一个React组件，这个组件能够将其接受的ref属性转发到其组件树下的另一个组件中。</p>
<p>这种情况并不常见，但是对于如下的场景尤其适用：</p>
<pre><code class="react">const FancyButton = React.forwardRef((props, ref) =&gt; (
  &lt;button ref={ref} className=&quot;FancyButton&quot;&gt;
    {props.children}
  &lt;/button&gt;
));

// You can now get a ref directly to the DOM button:
const ref = React.createRef();
&lt;FancyButton ref={ref}&gt;Click me!&lt;/FancyButton&gt;;</code></pre>
<p>对于FancyButton这个组件，我们可以把它看作一个按钮的高级封装，有时我们希望这个组件可以像操纵原生button（获取焦点，获取value）DOM那样被我们控制。</p>
<p>Ref转发允许我们给某些组件赋予ref，并将其向下传递给子组件。</p>
<p>再考虑上面的代码，具体流程是这样的：</p>
<ol>
<li>调用React.createRef创建一个React ref并交给变量ref。</li>
<li>把这个变量ref交给 FancyButton组件。</li>
<li>观察FancyButton组件，可以看到React.forwardRef接受的第二个参数ref，组件内ref向下传递给了button。</li>
<li>当ref挂载完成时，ref.current将指向button的DOM节点。</li>
</ol>
<blockquote>
<p>注意</p>
<p>第二个参数 <code>ref</code> 只在使用 <code>React.forwardRef</code> 定义组件时存在。常规函数和 class 组件不接收 <code>ref</code> 参数，且 props 中也不存在 <code>ref</code>。</p>
<p>Ref 转发不仅限于 DOM 组件，你也可以转发 refs 到 class 组件实例中。</p>
</blockquote>
<hr>
<h3 id="2-React-Lazy"><a href="#2-React-Lazy" class="headerlink" title="2. React.Lazy"></a>2. React.Lazy</h3><p><code>React.lazy()</code> 允许你定义一个动态加载的组件。这有助于缩减 bundle 的体积，并延迟加载在初次渲染时未用到的组件。</p>
<p><em>渲染 <code>lazy</code> 组件依赖该组件渲染树上层的 <code>&lt;React.Suspense&gt;</code> 组件。这是指定加载指示器（loading indicator）的方式。</em></p>
<p>Just like this:</p>
<pre><code class="react">const SomeComponent = React.lazy(() =&gt; import(&#39;./SomeComponent&#39;));</code></pre>
<p><code>React.Suspense</code> 可以指定加载指示器（loading indicator），以防其组件树中的某些子组件尚未具备渲染条件。</p>
<pre><code class="react">// 该组件是动态加载的
const OtherComponent = React.lazy(() =&gt; import(&#39;./OtherComponent&#39;));

function MyComponent() {
  return (
    // 显示 &lt;Spinner&gt; 组件直至 OtherComponent 加载完成
    &lt;React.Suspense fallback={&lt;Spinner /&gt;}&gt;
      &lt;div&gt;
        &lt;OtherComponent /&gt;
      &lt;/div&gt;
    &lt;/React.Suspense&gt;
  );
}</code></pre>
<p><strong>请注意，<code>lazy</code> 组件可以位于 <code>Suspense</code> 组件树的深处——它不必包装树中的每一个延迟加载组件。最佳实践是将<code>&lt;Suspense&gt;</code>置于你想展示加载指示器（loading indicator）的位置，而 <code>lazy()</code> 则可被放置于任何你想要做代码分割的地方。</strong></p>
</section><nav id="post-nav"><span class="prev"></span><span class="next"><a href="/%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81/">Older Posts<span class="arrow">→</span></a></span></nav><section><div id="disqus_thread"><noscript>'Please enable JavaScript to view the'<a href="http://disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript></div></section><script>(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());</script></article></section><footer id="footer"><div id="social"><a class="symbol" href="https://github.com/joe960913" target="_blank" rel="noopener"><i class="fa fa-github"></i></a><p class="small">You still have time</p></div></footer><script>hljs.initHighlightingOnLoad();</script></body></html>